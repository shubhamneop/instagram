{"ast":null,"code":"import _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nvar _jsxFileName = \"/var/www/html/react-native/instagram/frontend/components/main/Save.js\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport React, { useState } from \"react\";\nimport View from \"react-native-web/dist/exports/View\";\nimport Text from \"react-native-web/dist/exports/Text\";\nimport TextInput from \"react-native-web/dist/exports/TextInput\";\nimport Image from \"react-native-web/dist/exports/Image\";\nimport Button from \"react-native-web/dist/exports/Button\";\nimport StyleSheet from \"react-native-web/dist/exports/StyleSheet\";\nimport firebase from \"firebase\";\nimport { NavigationContainer } from \"@react-navigation/native\";\nimport Loader from \"../Loader\";\n\nrequire(\"firebase/firestore\");\n\nrequire(\"firebase/firebase-storage\");\n\nexport default function Save(props, _ref) {\n  var navigation = _ref.navigation;\n\n  var _useState = useState(\"\"),\n      _useState2 = _slicedToArray(_useState, 2),\n      caption = _useState2[0],\n      setCaption = _useState2[1];\n\n  var _useState3 = useState(false),\n      _useState4 = _slicedToArray(_useState3, 2),\n      loading = _useState4[0],\n      setLoading = _useState4[1];\n\n  var uploadImage = function uploadImage() {\n    var uri, response, childPath, blob, task, taskProgress, taskCompleted, taskError;\n    return _regeneratorRuntime.async(function uploadImage$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            setLoading(true);\n            uri = props.route.params.image;\n            _context.next = 4;\n            return _regeneratorRuntime.awrap(fetch(uri));\n\n          case 4:\n            response = _context.sent;\n            childPath = \"post/\" + firebase.auth().currentUser.uid + \"/\" + Math.random().toString(36);\n            _context.next = 8;\n            return _regeneratorRuntime.awrap(response.blob());\n\n          case 8:\n            blob = _context.sent;\n            task = firebase.storage().ref().child(childPath).put(blob);\n\n            taskProgress = function taskProgress(snapshot) {\n              console.log(\"transfree:\" + snapshot.bytesTransferred);\n            };\n\n            taskCompleted = function taskCompleted() {\n              task.snapshot.ref.getDownloadURL().then(function (snapshot) {\n                savePostData(snapshot);\n                console.log(snapshot);\n              });\n            };\n\n            taskError = function taskError(snapshot) {\n              console.log(snapshot);\n              setLoading(false);\n            };\n\n            task.on(\"state_changed\", taskProgress, taskError, taskCompleted);\n\n          case 14:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  };\n\n  var savePostData = function savePostData(downloadUrl) {\n    firebase.firestore().collection(\"posts\").doc(firebase.auth().currentUser.uid).collection(\"userPosts\").add({\n      downloadUrl: downloadUrl,\n      caption: caption,\n      creation: firebase.firestore.FieldValue.serverTimestamp()\n    }).then(function () {\n      setLoading(false);\n      props.navigation.popToTop();\n    });\n  };\n\n  return React.createElement(View, {\n    style: {\n      flex: 1\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 62,\n      columnNumber: 5\n    }\n  }, React.createElement(Loader, {\n    loading: loading,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 63,\n      columnNumber: 7\n    }\n  }), React.createElement(Image, {\n    source: {\n      uri: props.route.params.image\n    },\n    style: {\n      flex: 1\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 64,\n      columnNumber: 7\n    }\n  }), React.createElement(TextInput, {\n    style: styles.inputStyle,\n    placeholder: \"Write a caption....\",\n    onChangeText: function onChangeText(caption) {\n      return setCaption(caption);\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 65,\n      columnNumber: 7\n    }\n  }), React.createElement(Button, {\n    title: \"Save\",\n    onPress: function onPress() {\n      return uploadImage();\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 70,\n      columnNumber: 7\n    }\n  }));\n}\nvar styles = StyleSheet.create({\n  inputStyle: {\n    fontSize: 16,\n    backgroundColor: \"#fff\",\n    padding: 10,\n    borderWidth: 1,\n    borderColor: \"#ccc\",\n    width: \"100%\",\n    marginTop: 5,\n    marginBottom: 10,\n    color: \"#040707\",\n    paddingRight: 30\n  },\n  view: {\n    marginTop: 15,\n    padding: 15\n  }\n});","map":{"version":3,"sources":["/var/www/html/react-native/instagram/frontend/components/main/Save.js"],"names":["React","useState","firebase","NavigationContainer","Loader","require","Save","props","navigation","caption","setCaption","loading","setLoading","uploadImage","uri","route","params","image","fetch","response","childPath","auth","currentUser","uid","Math","random","toString","blob","task","storage","ref","child","put","taskProgress","snapshot","console","log","bytesTransferred","taskCompleted","getDownloadURL","then","savePostData","taskError","on","downloadUrl","firestore","collection","doc","add","creation","FieldValue","serverTimestamp","popToTop","flex","styles","inputStyle","StyleSheet","create","fontSize","backgroundColor","padding","borderWidth","borderColor","width","marginTop","marginBottom","color","paddingRight","view"],"mappings":";;;AAAA,OAAOA,KAAP,IAAgBC,QAAhB,QAAgC,OAAhC;;;;;;;AAEA,OAAOC,QAAP,MAAqB,UAArB;AACA,SAASC,mBAAT,QAAoC,0BAApC;AACA,OAAOC,MAAP;;AACAC,OAAO,CAAC,oBAAD,CAAP;;AACAA,OAAO,CAAC,2BAAD,CAAP;;AAEA,eAAe,SAASC,IAAT,CAAcC,KAAd,QAAqC;AAAA,MAAdC,UAAc,QAAdA,UAAc;;AAAA,kBACpBP,QAAQ,CAAC,EAAD,CADY;AAAA;AAAA,MAC3CQ,OAD2C;AAAA,MAClCC,UADkC;;AAAA,mBAEpBT,QAAQ,CAAC,KAAD,CAFY;AAAA;AAAA,MAE3CU,OAF2C;AAAA,MAElCC,UAFkC;;AAIlD,MAAMC,WAAW,GAAG,SAAdA,WAAc;AAAA;AAAA;AAAA;AAAA;AAAA;AAClBD,YAAAA,UAAU,CAAC,IAAD,CAAV;AACME,YAAAA,GAFY,GAENP,KAAK,CAACQ,KAAN,CAAYC,MAAZ,CAAmBC,KAFb;AAAA;AAAA,6CAGKC,KAAK,CAACJ,GAAD,CAHV;;AAAA;AAGZK,YAAAA,QAHY;AAKZC,YAAAA,SALY,aAMhBlB,QAAQ,CAACmB,IAAT,GAAgBC,WAAhB,CAA4BC,GANZ,SAOdC,IAAI,CAACC,MAAL,GAAcC,QAAd,CAAuB,EAAvB,CAPc;AAAA;AAAA,6CASCP,QAAQ,CAACQ,IAAT,EATD;;AAAA;AASZA,YAAAA,IATY;AAWZC,YAAAA,IAXY,GAWL1B,QAAQ,CAAC2B,OAAT,GAAmBC,GAAnB,GAAyBC,KAAzB,CAA+BX,SAA/B,EAA0CY,GAA1C,CAA8CL,IAA9C,CAXK;;AAaZM,YAAAA,YAbY,GAaG,SAAfA,YAAe,CAACC,QAAD,EAAc;AACjCC,cAAAA,OAAO,CAACC,GAAR,gBAAyBF,QAAQ,CAACG,gBAAlC;AACD,aAfiB;;AAiBZC,YAAAA,aAjBY,GAiBI,SAAhBA,aAAgB,GAAM;AAC1BV,cAAAA,IAAI,CAACM,QAAL,CAAcJ,GAAd,CAAkBS,cAAlB,GAAmCC,IAAnC,CAAwC,UAACN,QAAD,EAAc;AACpDO,gBAAAA,YAAY,CAACP,QAAD,CAAZ;AACAC,gBAAAA,OAAO,CAACC,GAAR,CAAYF,QAAZ;AACD,eAHD;AAID,aAtBiB;;AAwBZQ,YAAAA,SAxBY,GAwBA,SAAZA,SAAY,CAACR,QAAD,EAAc;AAC9BC,cAAAA,OAAO,CAACC,GAAR,CAAYF,QAAZ;AACAtB,cAAAA,UAAU,CAAC,KAAD,CAAV;AACD,aA3BiB;;AA4BlBgB,YAAAA,IAAI,CAACe,EAAL,CAAQ,eAAR,EAAyBV,YAAzB,EAAuCS,SAAvC,EAAkDJ,aAAlD;;AA5BkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAApB;;AA+BA,MAAMG,YAAY,GAAG,SAAfA,YAAe,CAACG,WAAD,EAAiB;AACpC1C,IAAAA,QAAQ,CACL2C,SADH,GAEGC,UAFH,CAEc,OAFd,EAGGC,GAHH,CAGO7C,QAAQ,CAACmB,IAAT,GAAgBC,WAAhB,CAA4BC,GAHnC,EAIGuB,UAJH,CAIc,WAJd,EAKGE,GALH,CAKO;AACHJ,MAAAA,WAAW,EAAXA,WADG;AAEHnC,MAAAA,OAAO,EAAPA,OAFG;AAGHwC,MAAAA,QAAQ,EAAE/C,QAAQ,CAAC2C,SAAT,CAAmBK,UAAnB,CAA8BC,eAA9B;AAHP,KALP,EAUGX,IAVH,CAUQ,YAAY;AAChB5B,MAAAA,UAAU,CAAC,KAAD,CAAV;AACAL,MAAAA,KAAK,CAACC,UAAN,CAAiB4C,QAAjB;AACD,KAbH;AAcD,GAfD;;AAiBA,SACE,oBAAC,IAAD;AAAM,IAAA,KAAK,EAAE;AAAEC,MAAAA,IAAI,EAAE;AAAR,KAAb;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE,oBAAC,MAAD;AAAQ,IAAA,OAAO,EAAE1C,OAAjB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IADF,EAEE,oBAAC,KAAD;AAAO,IAAA,MAAM,EAAE;AAAEG,MAAAA,GAAG,EAAEP,KAAK,CAACQ,KAAN,CAAYC,MAAZ,CAAmBC;AAA1B,KAAf;AAAkD,IAAA,KAAK,EAAE;AAAEoC,MAAAA,IAAI,EAAE;AAAR,KAAzD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAFF,EAGE,oBAAC,SAAD;AACE,IAAA,KAAK,EAAEC,MAAM,CAACC,UADhB;AAEE,IAAA,WAAW,EAAC,qBAFd;AAGE,IAAA,YAAY,EAAE,sBAAC9C,OAAD;AAAA,aAAaC,UAAU,CAACD,OAAD,CAAvB;AAAA,KAHhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAHF,EAQE,oBAAC,MAAD;AAAQ,IAAA,KAAK,EAAC,MAAd;AAAqB,IAAA,OAAO,EAAE;AAAA,aAAMI,WAAW,EAAjB;AAAA,KAA9B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IARF,CADF;AAYD;AAED,IAAMyC,MAAM,GAAGE,UAAU,CAACC,MAAX,CAAkB;AAC/BF,EAAAA,UAAU,EAAE;AACVG,IAAAA,QAAQ,EAAE,EADA;AAEVC,IAAAA,eAAe,EAAE,MAFP;AAGVC,IAAAA,OAAO,EAAE,EAHC;AAIVC,IAAAA,WAAW,EAAE,CAJH;AAKVC,IAAAA,WAAW,EAAE,MALH;AAMVC,IAAAA,KAAK,EAAE,MANG;AAOVC,IAAAA,SAAS,EAAE,CAPD;AAQVC,IAAAA,YAAY,EAAE,EARJ;AASVC,IAAAA,KAAK,EAAE,SATG;AAUVC,IAAAA,YAAY,EAAE;AAVJ,GADmB;AAa/BC,EAAAA,IAAI,EAAE;AACJJ,IAAAA,SAAS,EAAE,EADP;AAEJJ,IAAAA,OAAO,EAAE;AAFL;AAbyB,CAAlB,CAAf","sourcesContent":["import React, { useState } from \"react\";\nimport { View, Text, TextInput, Image, Button, StyleSheet } from \"react-native\";\nimport firebase from \"firebase\";\nimport { NavigationContainer } from \"@react-navigation/native\";\nimport Loader from \"../Loader\";\nrequire(\"firebase/firestore\");\nrequire(\"firebase/firebase-storage\");\n\nexport default function Save(props, { navigation }) {\n  const [caption, setCaption] = useState(\"\");\n  const [loading, setLoading] = useState(false);\n\n  const uploadImage = async () => {\n    setLoading(true);\n    const uri = props.route.params.image;\n    const response = await fetch(uri);\n\n    const childPath = `post/${\n      firebase.auth().currentUser.uid\n    }/${Math.random().toString(36)}`;\n\n    const blob = await response.blob();\n\n    const task = firebase.storage().ref().child(childPath).put(blob);\n\n    const taskProgress = (snapshot) => {\n      console.log(`transfree:${snapshot.bytesTransferred}`);\n    };\n\n    const taskCompleted = () => {\n      task.snapshot.ref.getDownloadURL().then((snapshot) => {\n        savePostData(snapshot);\n        console.log(snapshot);\n      });\n    };\n\n    const taskError = (snapshot) => {\n      console.log(snapshot);\n      setLoading(false);\n    };\n    task.on(\"state_changed\", taskProgress, taskError, taskCompleted);\n  };\n\n  const savePostData = (downloadUrl) => {\n    firebase\n      .firestore()\n      .collection(\"posts\")\n      .doc(firebase.auth().currentUser.uid)\n      .collection(\"userPosts\")\n      .add({\n        downloadUrl,\n        caption,\n        creation: firebase.firestore.FieldValue.serverTimestamp(),\n      })\n      .then(function () {\n        setLoading(false);\n        props.navigation.popToTop();\n      });\n  };\n\n  return (\n    <View style={{ flex: 1 }}>\n      <Loader loading={loading} />\n      <Image source={{ uri: props.route.params.image }} style={{ flex: 1 }} />\n      <TextInput\n        style={styles.inputStyle}\n        placeholder=\"Write a caption....\"\n        onChangeText={(caption) => setCaption(caption)}\n      />\n      <Button title=\"Save\" onPress={() => uploadImage()} />\n    </View>\n  );\n}\n\nconst styles = StyleSheet.create({\n  inputStyle: {\n    fontSize: 16,\n    backgroundColor: \"#fff\",\n    padding: 10,\n    borderWidth: 1,\n    borderColor: \"#ccc\",\n    width: \"100%\",\n    marginTop: 5,\n    marginBottom: 10,\n    color: \"#040707\",\n    paddingRight: 30,\n  },\n  view: {\n    marginTop: 15,\n    padding: 15,\n  },\n});\n"]},"metadata":{},"sourceType":"module"}